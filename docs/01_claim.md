# マインドマップアプリの作成検討   
# マインドマップアプリの要求   
## やりたいこと   
- ノードグラフ表示による単語の分類、階層化   
- 単語単位のノードを手軽に作って、登場要素の洗い出し   
- ノードの親を付け替え編集可能（ドラッグ＆ドロップ操作を希望、工数によりボタン操作も検討）   
- ノードおよび連結ラインの色変更   
- コンテキストの途中で分岐できる LLM チャットの実装   
- ノード 1つ1つがタイトルとは別の LLM への質問とその回答を持つ   
- ルートから現在のノードへの経路を、コンテキストの結合として LLM への質問に利用できる   
- マインドマップのツリー構造の上に、ツリー状コンテキストを持った LLM チャット、ドキュメントを持つことができる   
- 注視したノードまでのコンテキストをサマライズして markdown ドキュメントとして export   
- キャンパス上のマインドマップデータを markdown 型のテキストとして保存、読み込み（フォーマットは後段フェーズで検討）   
   
## 機能   
### ノードとグラフ表示   
- ノードには `root` フラグがあり、サブノードがあった場合 `root` フラグのついたノードまで親を辿ることができる。   
- キャンパス上に `root` ノードは複数置ける。   
- `root` ノードは角丸四角、通常ノードは四角で表示。   
- キャンパスはドラッグしてスクロールできる。   
- ノード上にはタイトルテキストだけが表示されている。   
- **ノードの識別**: ノードは「単語」をタイトルとして持ち、これがノードの識別子となる。   
    - ノード名変更時、同名のノードが既に存在する場合はエラーとし、変更を許可しない。   
    - 新規ノード作成時、同名のノードが既に存在する場合は、末尾にインデックス番号（例: `単語\_1`）を付与して重複を回避する。   
- **ノードの色**: ノードおよびそのノードから親への連結ラインは、ノードが持つ色情報に基づいて表示される。   
    - ノード詳細情報ペイン内で色選択パレットが利用できるようにする。   
    - サブノード作成時は親の色を参照し、初期色として継承する。作成後も個別に色変更は可能。   
   
### LLMチャット機能   
- ノード 1つ1つが「タイトル」「LLM質問」「LLM解答」といった3つのテキスト情報を持つ。   
- ノードは親ノードの情報を持つ。   
- ノードの詳細情報で詳細な問題、質問を書き込むと LLM の回答を得られる。   
- LLM への質問時は、ルートノードまで辿った他のノードの質問と回答がこれまでのコンテキストとして扱われ、過去の会話を反映した回答が得られる。   
    - コンテキストは OpenAI API でいう `chat` の `assistant`, `user` 項目としてリストに列挙し API に渡す。   
    - 会話履歴の途中から別の話題に質問分岐できる。   
- LLM は OpenRouter を利用する予定。APIキーや利用モデルは `.env` ファイル等で指定する。   
- ノード詳細情報のペインにはサマライズボタンがあって、押すとこれまでのコンテキストをサマライズした結果をダイアログのテキストボックスに markdown で表示する。   
   
### ユーザーインターフェース (UI)   
- 上部ヘッダーに基本機能ボタンがある。   
    - ルートノード作成   
    - 新規ノード作成   
    - ノード削除   
    - 親付け替え（ボタン操作の場合）   
    - etc.（仕様検討時に必要であれば追加）   
- 右にノード詳細情報ペインが有り、ペイン開け閉めボタンで表示非表示ができる。   
   
### その他   
- 個人製作の小規模ツールであり、テストや非機能要求といった品質項目はここでは議論しない。   
