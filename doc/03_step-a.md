# 開発ステップA: マインドマップの基本構造と表示 (MVP)

## 1. 目標
マインドマップの視覚的な作成と編集ができるコア機能を提供する。このステップが完了すると、ユーザーはノードを作成、編集、削除し、それらを視覚的に整理できるようになる。

---

## 2. 関連仕様

### 2.1. コア機能
- **マインドマップ描画エンジン**:
    - Webベースのインタラクティブなグラフ描画ライブラリ（React Flow）を利用する。
    - ノードとエッジ（連結線）をキャンバス上にレンダリングする。
    - ノードのドラッグ＆ドロップによる移動、キャンバスのドラッグによるスクロール（パン）、およびズームに対応する。
- **データ構造**:
    - アプリケーションの状態は状態管理ライブラリ（Zustand）で一元管理する。
    - **ノードオブジェクト**:
        - `id`: 一意の識別子 (string)
        - `title`: ノードのタイトル (string)
        - `color`: ノードの色 (string, hexコード)
        - `isRoot`: ルートノードかどうかのフラグ (boolean)
        - `parentId`: 親ノードのID (string | null)
        - `position`: キャンバス上の座標 (object: {x, y})
- **UIコンポーネント**:
    - **ヘッダー**: アプリ全体の操作を行うボタンを配置。
    - **マインドマップキャンバス**: マインドマップを描画するメインエリア。
    - **詳細情報サイドバー**: 選択されたノードの詳細情報を表示・編集するためのフォーム。開閉可能とする。
    - **カスタムノード**:
        - **ルートノード**: 角丸四角形で表示。
        - **通常ノード**: 四角形で表示。
    - **色選択ピッカー**: サイドバーに配置し、直感的な色変更を可能にする。

### 2.2. ノード操作
- **作成**:
    - ヘッダーの「ルートノード作成」ボタンで、`isRoot: true` のノードをキャンバスに追加する。
    - ヘッダーの「新規ノード作成」ボタンで、現在選択中のノードの子ノードを作成する。親が選択されていない場合は何もしない。
    - ノード名（タイトル）の重複チェックを行い、重複する場合は末尾にインデックス（例: `_1`, `_2`）を自動付与する。
- **編集**:
    - サイドバーのフォームを通じて、ノードのタイトルと色を編集・更新できる。
- **削除**:
    - ヘッダーの「ノード削除」ボタンで、選択中のノード（およびその全子孫ノード）を削除する。
- **親子関係変更**:
    - ドラッグ＆ドロップ操作でノードを別のノードの上に重ねることで、親を変更できるようにする。

---

## 3. タスク一覧

1.  **環境構築 & プロジェクトセットアップ**
    - `Vite` + `React` + `TypeScript` でプロジェクトを作成。
    - `ESLint`, `Prettier` でコードフォーマットを統一。
    - UIフレームワーク（MUI）、状態管理（Zustand）、マインドマップ描画（React Flow）を導入。
2.  **UIコンポーネント実装**
    - `Header.tsx`: ルートノード作成、新規ノード作成、ノード削除ボタンを配置。
    - `MindMapCanvas.tsx`: React Flowをラップし、カスタムノードとエッジを描画。
    - `Sidebar.tsx`: ノードタイトル編集用のテキストフィールドと、色選択ピッカーを実装。
    - `RootNode.tsx`, `NormalNode.tsx`: isRootフラグに応じて表示が変わるカスタムノードを作成。
3.  **マインドマップ基本機能実装**
    - `Zustand` ストアを設計し、ノード配列（`nodes`）とエッジ配列（`edges`）を管理する。
    - ノードのCRUD（作成、読み取り、更新、削除）ロジックをストアのアクションとして実装。
        - **作成**: 新規ノードと、親がいる場合はエッジを追加する。
        - **更新**: タイトルや色の変更を特定のノードに適用する。
        - **削除**: ノードと関連するエッジ、さらに子孫ノードを再帰的に削除する。
    - ノード選択時にそのIDをストアに保持し、サイドバーに情報を表示するロジックを実装。
    - React Flowの標準機能であるノードのドラッグ移動、パン、ズームを有効化する。
4.  **親子関係編集機能実装**
    - React Flowの `onNodeDragStop` と `onNodeDrop` イベントハンドラを利用する。
    - ドロップされたノードが他のノード上にあるかを判定し、`parentId` を更新するロジックを実装する。
    - 親子関係の変更に伴い、エッジを再描画する。
5.  **リファインメント**
    - UI/UXの基本的な体裁を整える。
    - ノード名重複時のエラーハンドリングを実装する。

